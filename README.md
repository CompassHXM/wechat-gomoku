# 五子棋联机对战 - 快速开始

## 📦 项目结构

```
wuziqi/
├── miniprogram/              # 小程序主目录
│   ├── pages/
│   │   ├── index/           # 首页（选择游戏模式）
│   │   ├── lobby/           # 联机大厅（昵称输入、房间列表）
│   │   ├── game/            # 游戏页面（棋盘）
│   │   └── logs/            # 日志页面
│   ├── utils/               # 工具类
│   │   ├── config.ts        # 配置文件（Azure API地址）
│   │   ├── api.ts           # API请求工具
│   │   └── websocket.ts     # WebSocket管理
│   ├── app.ts               # 小程序入口
│   └── app.json             # 小程序配置
├── backend/                  # Azure后端服务（新增）
│   ├── src/
│   │   ├── config/          # 数据库和PubSub配置
│   │   ├── services/        # 业务逻辑
│   │   ├── routes/          # API路由
│   │   └── index.ts         # 服务入口
│   ├── package.json
│   └── Dockerfile           # Docker配置
├── cloudfunctions/           # 腾讯云函数（原方案）
│   └── login/               # 登录云函数（获取openid）
├── Azure部署指南.md          # Azure云服务部署文档（推荐）
├── 云开发配置说明.md         # 腾讯云开发配置文档
└── 云服务方案对比.md         # 两种方案的详细对比
```

## 🎯 云服务方案选择

本项目支持两种云服务部署方案：

### 🔵 方案一：Azure云服务（推荐）

**适合场景：**
- ✅ 想要学习现代云架构
- ✅ 需要跨平台支持
- ✅ 有一定后端开发经验
- ✅ 想要更强的控制能力

**配置时间：** 1-2小时  
**月成本：** <$5（使用免费层）  
**查看文档：** [Azure部署指南.md](./Azure部署指南.md)

### 🟢 方案二：腾讯云开发

**适合场景：**
- ✅ 只做微信小程序
- ✅ 想要快速上线
- ✅ 不熟悉后端开发
- ✅ 小规模项目

**配置时间：** 15-30分钟  
**月成本：** ¥10-30  
**查看文档：** [云开发配置说明.md](./云开发配置说明.md)

**详细对比：** [云服务方案对比.md](./云服务方案对比.md)

---

## 🚀 快速开始（5分钟）

### 方式一：仅使用本地对战（无需配置）

1. 用微信开发者工具打开项目
2. 点击"本地对战"按钮
3. 两人在同一设备上轮流下棋

### 方式二：配置联机对战

#### A. 使用Azure云服务（推荐）

完整步骤请查看：**[Azure部署指南.md](./Azure部署指南.md)**

**快速步骤概览：**
1. 创建Azure Cosmos DB（数据库）
2. 创建Azure Web PubSub（实时通信）
3. 部署后端服务到Azure App Service
4. 修改小程序配置文件
5. 配置小程序服务器域名

#### B. 使用腾讯云开发

完整步骤请查看：**[云开发配置说明.md](./云开发配置说明.md)**

#### 第一步：开通云开发（1分钟）

1. 在微信开发者工具中点击顶部"云开发"按钮
2. 按提示开通云开发（需要实名认证）
3. 创建环境，记下环境ID（如：cloud1-xxx）

#### 第二步：配置环境ID（30秒）

修改 `miniprogram/app.ts` 第6行：

```typescript
wx.cloud.init({
  traceUser: true,
  env: 'cloud1-xxx' // 替换为你的实际环境ID
})
```

#### 第三步：创建数据库集合（1分钟）

1. 在云开发控制台，点击"数据库"
2. 点击"添加集合"
3. 集合名：`game_rooms`
4. 权限：所有用户可读、所有用户可写
5. 点击确定

可选：添加索引提高性能
- 索引1：status（升序）
- 索引2：createTime（降序）

#### 第四步：部署云函数（1分钟）

1. 在开发者工具左侧，展开 `cloudfunctions` 目录
2. 右键点击 `login` 文件夹
3. 选择"上传并部署：云端安装依赖"
4. 等待部署完成（显示绿色对勾）

#### 第五步：测试联机功能（1分钟）

1. 编译运行小程序
2. 点击"联机对战"
3. 输入昵称（如：玩家1）
4. 点击"创建房间"
5. 打开第二个模拟器（或真机），重复2-3步
6. 点击房间列表中的房间，加入游戏
7. 开始对战！🎉

---

## 🎮 功能特点

### 双模式支持
- **本地对战**：无需网络，两人同一设备轮流下棋
- **联机对战**：实时对战，支持旁观

### 联机对战特性
✅ 实时同步：延迟<500ms  
✅ 自动匹配：创建/加入房间  
✅ 玩家昵称：自定义显示  
✅ 黑白分配：先进先黑（先手）  
✅ 旁观模式：房间满员后可旁观  
✅ 权限控制：轮到自己才能下棋  
✅ 胜负判定：五子连珠自动判定  

### 游戏规则
- 15×15 标准棋盘
- 黑方先手
- 先连成五子者获胜
- 棋盘下满无胜者为平局

---

## 🛠️ 技术栈

### 前端
- **框架**：微信小程序原生开发
- **UI**：Canvas 2D API（新版）
- **TypeScript**：类型安全

### 后端（Azure方案）
- **API服务**：Node.js + Express
- **数据库**：Azure Cosmos DB
- **实时通信**：Azure Web PubSub
- **部署**：Azure App Service

### 后端（腾讯云开发方案）
- **云数据库**：存储房间信息
- **云函数**：获取用户openid
- **实时推送**：watch API

---

## 📱 测试建议

### 联机功能测试
1. **方法一**：使用两个微信开发者工具
   - 打开两个开发者工具实例
   - 同时运行项目

2. **方法二**：开发者工具 + 真机
   - 在开发者工具中创建房间
   - 用手机扫码预览并加入

3. **方法三**：两台真机
   - 扫码在两台手机上预览
   - 更真实的测试体验

### 旁观功能测试
- 让三个或更多用户加入同一房间
- 前两个成为玩家，后续成为旁观者

---

## 🐛 常见问题

### Azure方案常见问题
见 [Azure部署指南.md](./Azure部署指南.md) 的"常见问题"章节

### 腾讯云开发常见问题

1. 在微信开发者工具中点击顶部"云开发"按钮
2. 按提示开通云开发（需要实名认证）
3. 创建环境，记下环境ID（如：cloud1-xxx）

#### 第二步：配置环境ID（30秒）

修改 `miniprogram/app.ts` 第6行：

```typescript
wx.cloud.init({
  traceUser: true,
  env: 'cloud1-xxx' // 替换为你的实际环境ID
})
```

#### 第三步：创建数据库集合（1分钟）

1. 在云开发控制台，点击"数据库"
2. 点击"添加集合"
3. 集合名：`game_rooms`
4. 权限：所有用户可读、所有用户可写
5. 点击确定

可选：添加索引提高性能
- 索引1：status（升序）
- 索引2：createTime（降序）

#### 第四步：部署云函数（1分钟）

1. 在开发者工具左侧，展开 `cloudfunctions` 目录
2. 右键点击 `login` 文件夹
3. 选择"上传并部署：云端安装依赖"
4. 等待部署完成（显示绿色对勾）

#### 第五步：测试联机功能（1分钟）

1. 编译运行小程序
2. 点击"联机对战"
3. 输入昵称（如：玩家1）
4. 点击"创建房间"
5. 打开第二个模拟器（或真机），重复2-3步
6. 点击房间列表中的房间，加入游戏
7. 开始对战！🎉

## 🎮 功能特点

### 双模式支持
- **本地对战**：无需网络，两人同一设备轮流下棋
- **联机对战**：实时对战，支持旁观

### 联机对战特性
✅ 实时同步：使用云数据库 watch API，延迟<500ms
✅ 自动匹配：创建/加入房间
✅ 玩家昵称：自定义显示
✅ 黑白分配：先进先黑（先手）
✅ 旁观模式：房间满员后可旁观
✅ 权限控制：轮到自己才能下棋
✅ 胜负判定：五子连珠自动判定

### 游戏规则
- 15×15 标准棋盘
- 黑方先手
- 先连成五子者获胜
- 棋盘下满无胜者为平局

## 🛠️ 技术栈

- **前端**：微信小程序原生开发
- **UI**：Canvas 2D API（新版）
- **后端**：微信云开发
  - 云数据库（存储房间信息）
  - 云函数（获取用户openid）
  - 实时数据推送（watch API）

## 📱 测试建议

### 联机功能测试
1. **方法一**：使用两个微信开发者工具
   - 打开两个开发者工具实例
   - 同时运行项目

2. **方法二**：开发者工具 + 真机
   - 在开发者工具中创建房间
   - 用手机扫码预览并加入

3. **方法三**：两台真机
   - 扫码在两台手机上预览
   - 更真实的测试体验

### 旁观功能测试
- 让三个或更多用户加入同一房间
- 前两个成为玩家，后续成为旁观者

## 🐛 常见问题

### Q1: 点击"联机对战"后提示云开发错误
**A**: 检查是否已开通云开发并配置了正确的环境ID

### Q2: 创建房间失败
**A**: 检查数据库集合 `game_rooms` 是否已创建，权限是否设置正确

### Q3: 加入房间后看不到对方下棋
**A**: 检查云函数 `login` 是否已部署，网络是否正常

### Q4: 提示"请使用2.2.3或以上基础库"
**A**: 在项目设置中提高基础库版本到 2.2.3 以上

### Q5: 真机预览时无法联机
**A**: 
- 确保云函数已部署
- 检查小程序 AppID 是否正确
- 在"详情-本地设置"中勾选"不校验合法域名"（开发阶段）

## 📞 技术支持

遇到问题可以：
1. 查看 `云开发配置说明.md` 了解详细配置
2. 在微信开发者社区搜索相关问题
3. 查看云开发官方文档

## 🎯 后续优化建议

- [ ] 添加聊天功能
- [ ] 房间密码保护
- [ ] 游戏回放
- [ ] 排行榜系统
- [ ] AI 对战模式
- [ ] 自定义棋盘大小
- [ ] 禁手规则（如五手N打）
- [ ] 计时功能

---

祝游戏愉快！🎮
