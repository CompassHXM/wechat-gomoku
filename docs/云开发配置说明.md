# 五子棋联机对战配置说明

> **注意**：本项目现已支持Azure云服务部署。如果你想使用Azure而不是腾讯云开发，请参考 [Azure部署指南.md](./Azure部署指南.md)

## 云服务选择

本项目支持两种云服务方案：

### 方案一：腾讯云开发（原方案）
- **优点**：微信小程序原生支持，配置简单，开发工具集成好
- **缺点**：仅适用于微信生态，不易迁移到其他平台
- **成本**：免费额度较低，按量计费
- **配置文档**：继续阅读本文档

### 方案二：Azure云服务（推荐）
- **优点**：
  - 跨平台支持，代码可复用
  - 企业级服务，稳定性高
  - 全球部署，可选区域多
  - 免费额度充足（新用户$200，免费层服务）
- **缺点**：配置相对复杂，需要独立部署后端
- **成本**：使用免费层月成本<$5
- **配置文档**：见 [Azure部署指南.md](./Azure部署指南.md)

---

## 腾讯云开发配置（原方案）

### 1. 开通云开发

1. 在微信开发者工具中，点击顶部"云开发"按钮
2. 按提示开通云开发服务
3. 创建云环境（建议选择按量计费）
4. 记下你的环境 ID（例如：cloud1-xxx）

### 2. 配置环境 ID

修改 `miniprogram/app.ts` 文件中的环境 ID：

```typescript
wx.cloud.init({
  traceUser: true,
  env: 'your-env-id' // 替换为你的实际环境ID
})
```

### 3. 创建数据库集合

在云开发控制台中，创建以下集合：

#### game_rooms 集合（游戏房间）

权限设置：所有用户可读，所有用户可写

字段说明：
- roomNumber: Number - 房间号
- creator: Object - 创建者信息
  - openid: String
  - nickname: String
- players: Array - 玩家列表（最多2人）
  - openid: String
  - nickname: String
  - color: Number (1=黑子, 2=白子)
  - isReady: Boolean
- spectators: Array - 旁观者列表
  - openid: String
  - nickname: String
  - joinTime: Date
- board: Array - 棋盘状态（15x15二维数组）
- currentPlayer: Number - 当前玩家 (1或2)
- status: String - 游戏状态 (waiting/playing/finished)
- moveHistory: Array - 移动历史
  - row: Number
  - col: Number
  - player: Number
- winner: String - 获胜者昵称
- createTime: Date - 创建时间
- updateTime: Date - 更新时间

索引建议：
- status (升序)
- createTime (降序)

### 4. 部署云函数

1. 右键点击 `cloudfunctions/login` 目录
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 5. 测试

1. 在微信开发者工具中运行小程序
2. 点击"联机对战"按钮
3. 输入昵称
4. 创建或加入房间
5. 等待另一个玩家加入（可以打开多个模拟器测试）

## 功能说明

### 联机对战流程

1. **进入大厅**：用户输入昵称后进入房间列表
2. **创建房间**：创建者自动成为黑方（先手）
3. **加入房间**：
   - 第二个玩家加入成为白方，游戏开始
   - 第三个及以上玩家以旁观者身份加入
4. **游戏进行**：
   - 双方轮流下棋
   - 实时同步棋盘状态
   - 旁观者可实时观看
5. **游戏结束**：显示获胜者或平局

### 权限控制

- 只有轮到自己时才能下棋
- 旁观者不能下棋
- 离线模式支持悔棋，联机模式不支持

### 实时同步

使用微信云开发的数据库实时推送功能（watch API），实现：
- 玩家加入/退出实时通知
- 棋盘状态实时同步
- 游戏结果实时更新

## 注意事项

1. 需要使用真机或模拟器测试联机功能
2. 确保网络连接正常
3. 云开发环境需要实名认证
4. 按量计费环境每月有免费额度
5. 建议为数据库集合添加索引以提高查询性能

## 本地对战

如果不想配置云开发，可以直接使用"本地对战"功能：
- 两人在同一设备上轮流下棋
- 支持悔棋和重新开始
- 无需网络连接
